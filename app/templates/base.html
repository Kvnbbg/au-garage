<!DOCTYPE html>
<html lang="{{ session.get('lang', 'en') }}">
<head>
  <!-- Meta Information & Security -->
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Language" content="{{ session.get('lang', 'en') }}">
  <meta name="description" content="Au Garage – A hub for automotive and mechanical excellence.">
  <meta name="keywords" content="Mechanics, Classical Mechanics, Engineering, Simulation, Calibration">
  <meta name="author" content="Kevin Marville">
  <meta name="msapplication-tap-highlight" content="no">
  <!-- Security Headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="DENY">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://code.jquery.com https://cdn.jsdelivr.net https://stackpath.bootstrapcdn.com https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com;">
  <title>{% block title %}Au Garage - SaaS Platform{% endblock %}</title>
  
  <!-- Favicon -->
  <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
  
  <!-- External Stylesheets -->
  <link rel="stylesheet" href="https://demo.dashboardpack.com/architectui-html-free/main.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Custom Extended CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

  <!-- Inline Styles & Tailwind Setup -->
  <style>
    <script src="https://cdn.tailwindcss.com"></script>
    /* Global Variables & Base Styles */
    :root {
      --primary-color: #6f4e37;
      --secondary-color: #8b5e3c;
      --accent-color: #d2a679;
      --highlight-color: #c87533;
      --background-color: #f7f3e8;
      --text-color: #4b382a;
      --card-bg: #ffffff;
      --border-color: #d2a679;
      --transition-speed: 0.3s;
      --border-radius: 8px;
      --shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    body {
      font-family: 'Roboto', sans-serif;
      background: var(--background-color);
      color: var(--text-color);
      padding: 20px;
      min-height: 100vh;
      transition: background 0.5s ease, color 0.5s ease;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: var(--card-bg);
      padding: 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
    }
    /* Tables & Buttons */
    .log-container {
      height: 250px;
      overflow-y: auto;
      border: 1px solid var(--border-color);
      padding: 10px;
      border-radius: var(--border-radius);
      background: var(--highlight-color);
    }
    .btn {
      padding: 10px 15px;
      border-radius: var(--border-radius);
      border: none;
      cursor: pointer;
      transition: background var(--transition-speed);
    }
    .btn-primary { background: var(--primary-color); color: #fff; }
    .btn-secondary { background: var(--secondary-color); color: #fff; }
    .btn:hover { opacity: 0.8; }
    .hover-light:hover {
      filter: brightness(1.2);
      transition: filter 0.2s ease;
    }
    .zoom-on-hover {
      transition: transform 0.3s ease;
    }
    .zoom-on-hover:hover {
      transform: scale(1.05);
    }
    /* Particle Effect for Buttons */
    .particle-effect {
      position: relative;
      overflow: hidden;
    }
    .particle-effect::after {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .particle-effect:hover::after {
      opacity: 1;
    }
    /* Floating Panels for Connectivity */
    #blueskyLogPanel, #vrLogPanel {
      width: 320px;
      background: #f7f3e8;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      z-index: 9999;
      display: none;
    }
    #blueskyLogPanel {
      position: fixed;
      bottom: 20px;
      right: 20px;
    }
    #vrLogPanel {
      position: fixed;
      bottom: 20px;
      left: 20px;
    }
    #blueskyLogPanel header, #vrLogPanel header {
      background: #333;
      color: #fff;
      padding: 8px;
      text-align: center;
      border-top-left-radius: var(--border-radius);
      border-top-right-radius: var(--border-radius);
    }
    #blueskyLogPanel .panel-body, #vrLogPanel .panel-body {
      padding: 10px;
    }
    /* Floating Ko‑fi Bubble */
    #kofiBubble {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: #fff;
      border: 1px solid var(--border-color);
      border-radius: 50%;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 9999;
      transition: transform 0.3s ease;
    }
    #kofiBubble:hover {
      transform: scale(1.1);
    }
    /* Live Notifications Panel (upper center) */
    #notificationPanel {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 800px;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      z-index: 9998;
      padding: 10px;
      overflow: hidden;
      transition: opacity 0.3s ease;
    }
    #notificationPanel.hidden {
      opacity: 0;
      pointer-events: none;
    }
    /* Feedback Modal Styles */
    .modal-feedback {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90%;
      max-width: 500px;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      z-index: 10000;
      padding: 20px;
    }
    .modal-feedback.active {
      display: block;
    }
    .modal-feedback header {
      font-size: 1.25em;
      margin-bottom: 10px;
    }
    .modal-feedback textarea {
      width: 100%;
      min-height: 100px;
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
    }
  </style>
  
  <!-- Structured Data -->
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "AutoRepair",
      "name": "Au Garage",
      "url": "https://github.com/Kvnbbg/au-garage",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "xxxxx",
        "addressLocality": "Rivierre-Salée, Martinique",
        "postalCode": "97215",
        "addressCountry": "MQ"
      },
      "telephone": "+33634160418"
    }
  </script>
  {% block head %}{% endblock %}
</head>
<body class="d-flex flex-column" style="min-height: 100vh;">
  <!-- HEADER: Navigation Bar -->
  <header>
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="{{ url_for('main.home') }}">
          <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo">
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse"
                data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup"
                aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item"><a class="nav-link hover-light" href="{{ url_for('auth.set_language', language='en') }}">🇺🇸 English</a></li>
            <li class="nav-item"><a class="nav-link hover-light" href="{{ url_for('auth.set_language', language='fr') }}">🇫🇷 Français</a></li>
            <li class="nav-item"><a class="nav-link hover-light" href="#" data-toggle="modal" data-target="#versionModal">Version</a></li>
            <!-- Connection Buttons -->
            <li class="nav-item">
              <a class="nav-link hover-light" href="#" id="blueskyConnectBtn">Bluesky Connect</a>
            </li>
            <li class="nav-item">
              <a class="nav-link hover-light" href="#" id="vrConnectBtn">VR Connect</a>
            </li>
            <!-- Additional Options -->
            <li class="nav-item">
              <a class="nav-link hover-light" href="#" id="darkModeToggle">Toggle Dark Mode</a>
            </li>
            <li class="nav-item">
              <a class="nav-link hover-light" href="#" id="feedbackBtn">Feedback</a>
            </li>
            {% if not current_user.is_authenticated %}
              <li class="nav-item"><a class="nav-link hover-light" href="{{ url_for('auth.login') }}">Login</a></li>
              <li class="nav-item"><a class="nav-link hover-light" href="https://kvnbbg.github.io/500Discount/">5D</a></li>
            {% else %}
              <li class="nav-item"><a class="nav-link hover-light" href="{{ url_for('auth.dashboard') }}">Dashboard</a></li>
              <li class="nav-item"><a class="nav-link hover-light" href="{{ url_for('auth.logout') }}">Logout</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>
  </header>
  
  <!-- HERO SECTION -->
  <section class="py-5 bg-image-full" style="background-image: url('{{ url_for('static', filename='images/service-example.jpg') }}');">
    <div class="container text-center">
      <div class="my-5">
        {% if session.get('lang', 'en') == 'fr' %}
          <h1 class="text-white zoom-on-hover" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">Laboratoire de Mécanique</h1>
          <h2 class="text-white-50 zoom-on-hover" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">Fondements et applications de la mécanique classique</h2>
        {% else %}
          <h1 class="text-white zoom-on-hover" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">Mechanics Laboratory</h1>
          <h2 class="text-white-50 zoom-on-hover" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.7);">Fundamentals and Applications of Classical Mechanics</h2>
        {% endif %}
      </div>
    </div>
  </section>
  
  <!-- MAIN CONTENT SECTIONS -->
  <main class="slide-container flex-grow-1">
    <div class="container my-5">
      <!-- About Section -->
      <section id="about" class="mb-5">
        {% if session.get('lang', 'en') == 'fr' %}
          <h2 class="decorative-title">Principes de la Mécanique</h2>
          <p>La mécanique classique étudie le mouvement des corps et les forces qui les influencent. Les lois de Newton sont à la base de cette étude, permettant de comprendre et simuler le comportement des systèmes physiques complexes.</p>
        {% else %}
          <h2 class="decorative-title">Principles of Mechanics</h2>
          <p>Classical mechanics explores the motion of bodies and the forces acting on them. Newton’s laws provide the foundation to understand and simulate complex physical systems.</p>
        {% endif %}
        <button class="btn popup-trigger particle-effect" id="examplePopup">
          {% if session.get('lang', 'en') == 'fr' %}Ouvrir le conseil mécanique{% else %}Open Mechanic Advice{% endif %}
        </button>
      </section>
      
      <!-- Mechanical Data Acquisition Section -->
      <section id="spreadsheet" class="mb-5">
        {% if session.get('lang', 'en') == 'fr' %}
          <h2 class="decorative-title">Acquisition de Données Mécaniques</h2>
          <p>Mesurez et enregistrez des données physiques (couple, force, pression, température) pour calibrer, simuler et valider vos modèles expérimentaux.</p>
        {% else %}
          <h2 class="decorative-title">Mechanical Data Acquisition</h2>
          <p>Record and measure physical data (torque, force, pressure, temperature) to calibrate, simulate, and validate your experimental models.</p>
        {% endif %}
        <div class="spreadsheet-container">
          <table id="spreadsheetTable" class="table table-bordered excel-table">
            <thead>
              <tr>
                <th contenteditable="true">{% if session.get('lang', 'en') == 'fr' %}Couple (Nm){% else %}Torque (Nm){% endif %}</th>
                <th contenteditable="true">{% if session.get('lang', 'en') == 'fr' %}Force (N){% else %}Force (N){% endif %}</th>
                <th contenteditable="true">{% if session.get('lang', 'en') == 'fr' %}Pression (Pa){% else %}Pressure (Pa){% endif %}</th>
                <th contenteditable="true">{% if session.get('lang', 'en') == 'fr' %}Température (°C){% else %}Temperature (°C){% endif %}</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td contenteditable="true">150</td>
                <td contenteditable="true">1200</td>
                <td contenteditable="true">101325</td>
                <td contenteditable="true">85</td>
              </tr>
              <tr>
                <td contenteditable="true">200</td>
                <td contenteditable="true">1500</td>
                <td contenteditable="true">100000</td>
                <td contenteditable="true">90</td>
              </tr>
            </tbody>
          </table>
          <div class="spreadsheet-controls mt-3">
            <button id="addRow" class="btn btn-secondary">
              {% if session.get('lang', 'en') == 'fr' %}Ajouter une mesure{% else %}Add Measurement{% endif %}
            </button>
            <button id="removeRow" class="btn btn-danger">
              {% if session.get('lang', 'en') == 'fr' %}Supprimer une mesure{% else %}Remove Measurement{% endif %}
            </button>
            <button id="calibrateData" class="btn btn-warning">
              {% if session.get('lang', 'en') == 'fr' %}Calibrer les données{% else %}Calibrate Data{% endif %}
            </button>
            <button id="simulatePerf" class="btn btn-primary">
              {% if session.get('lang', 'en') == 'fr' %}Simuler la performance{% else %}Simulate Performance{% endif %}
            </button>
            <button id="saveSheet" class="btn btn-success">
              {% if session.get('lang', 'en') == 'fr' %}Sauvegarder{% else %}Save Data{% endif %}
            </button>
            <button id="loadSheet" class="btn btn-info">
              {% if session.get('lang', 'en') == 'fr' %}Charger{% else %}Load Data{% endif %}
            </button>
          </div>
        </div>
      </section>
      
      <!-- Dynamic Features Section -->
      <section id="dynamic-ui" class="mb-5">
        {% if session.get('lang', 'en') == 'fr' %}
          <h2 class="decorative-title">Fonctionnalités Dynamiques</h2>
          <p>Des éléments interactifs et dynamiques se génèrent pour illustrer des concepts avancés et offrir une expérience utilisateur enrichie.</p>
        {% else %}
          <h2 class="decorative-title">Dynamic Features</h2>
          <p>Interactive elements are generated dynamically to illustrate advanced concepts and deliver an enhanced user experience.</p>
        {% endif %}
      </section>
      
      <!-- Three.js Car Simulation Section -->
      <section id="threejs-simulation" class="mb-5 text-center">
        {% if session.get('lang', 'en') == 'fr' %}
          <h2 class="decorative-title">Simulation 3D de Voiture</h2>
          <p>Une simulation 3D interactive basée sur les principes newtoniens pour illustrer le mouvement et la force.</p>
        {% else %}
          <h2 class="decorative-title">3D Car Simulation</h2>
          <p>An interactive 3D simulation based on Newtonian principles to illustrate motion and force.</p>
        {% endif %}
        <div id="threejs-controls" class="mb-3">
          <button id="left-btn" class="btn btn-secondary mx-1">
            {% if session.get('lang', 'en') == 'fr' %}Gauche{% else %}Left{% endif %}
          </button>
          <button id="right-btn" class="btn btn-secondary mx-1">
            {% if session.get('lang', 'en') == 'fr' %}Droite{% else %}Right{% endif %}
          </button>
          <button id="up-btn" class="btn btn-success mx-1">
            {% if session.get('lang', 'en') == 'fr' %}Accélérer{% else %}Accelerate{% endif %}
          </button>
          <button id="stop-btn" class="btn btn-danger mx-1">
            {% if session.get('lang', 'en') == 'fr' %}Arrêter{% else %}Stop{% endif %}
          </button>
        </div>
        <div id="threejs-canvas-container" style="position: relative; width: 100%; height: 400px; margin: 0 auto;"></div>
        <p>
          {% if session.get('lang', 'en') == 'fr' %}
            La simulation est affichée ci-dessus.
          {% else %}
            The simulation is rendered above.
          {% endif %}
        </p>
      </section>
      
      <!-- Carousel / Featured Content Section -->
      <section id="carousel" class="mb-5">
        {% if session.get('lang', 'en') == 'fr' %}
          <h2 class="decorative-title">Contenu Mis en Avant</h2>
        {% else %}
          <h2 class="decorative-title">Featured Content</h2>
        {% endif %}
        <div id="featuredCarousel" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            <li data-target="#featuredCarousel" data-slide-to="0" class="active"></li>
            <li data-target="#featuredCarousel" data-slide-to="1"></li>
            <li data-target="#featuredCarousel" data-slide-to="2"></li>
          </ol>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img src="{{ url_for('static', filename='images/slide1.jpg') }}" class="d-block w-100" alt="Slide 1">
              <div class="carousel-caption d-none d-md-block">
                {% if session.get('lang', 'en') == 'fr' %}
                  <h5>Étude de Mécanique 1</h5>
                  <p>Description de l'étude de mécanique 1.</p>
                {% else %}
                  <h5>Mechanics Study 1</h5>
                  <p>Description of Mechanics Study 1.</p>
                {% endif %}
              </div>
            </div>
            <div class="carousel-item">
              <img src="{{ url_for('static', filename='images/slide2.jpg') }}" class="d-block w-100" alt="Slide 2">
              <div class="carousel-caption d-none d-md-block">
                {% if session.get('lang', 'en') == 'fr' %}
                  <h5>Étude de Mécanique 2</h5>
                  <p>Description de l'étude de mécanique 2.</p>
                {% else %}
                  <h5>Mechanics Study 2</h5>
                  <p>Description of Mechanics Study 2.</p>
                {% endif %}
              </div>
            </div>
            <div class="carousel-item">
              <img src="{{ url_for('static', filename='images/slide3.jpg') }}" class="d-block w-100" alt="Slide 3">
              <div class="carousel-caption d-none d-md-block">
                {% if session.get('lang', 'en') == 'fr' %}
                  <h5>Étude de Mécanique 3</h5>
                  <p>Description de l'étude de mécanique 3.</p>
                {% else %}
                  <h5>Mechanics Study 3</h5>
                  <p>Description of Mechanics Study 3.</p>
                {% endif %}
              </div>
            </div>
          </div>
          <a class="carousel-control-prev" href="#featuredCarousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">
              {% if session.get('lang', 'en') == 'fr' %}Précédent{% else %}Previous{% endif %}
            </span>
          </a>
          <a class="carousel-control-next" href="#featuredCarousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">
              {% if session.get('lang', 'en') == 'fr' %}Suivant{% else %}Next{% endif %}
            </span>
          </a>
        </div>
      </section>
      
      <!-- Live Notifications Section -->
      <section id="live-notifications" class="mb-5">
        <h2 class="decorative-title">Live Notifications</h2>
        <p>This area will display real‑time updates, alerts, and news. Check back often for new notifications!</p>
      </section>
      
      <!-- Feedback Section -->
      <section id="feedback-section" class="mb-5">
        <h2 class="decorative-title">Feedback & Support</h2>
        <p>We value your feedback. Click the “Feedback” button in the navbar or use the form below to share your thoughts.</p>
        <form id="feedbackForm">
          <div class="form-group">
            <label for="feedbackName">Your Name:</label>
            <input type="text" id="feedbackName" class="form-control" placeholder="Enter your name">
          </div>
          <div class="form-group">
            <label for="feedbackEmail">Your Email:</label>
            <input type="email" id="feedbackEmail" class="form-control" placeholder="Enter your email">
          </div>
          <div class="form-group">
            <label for="feedbackMessage">Your Feedback:</label>
            <textarea id="feedbackMessage" class="form-control" placeholder="Enter your feedback"></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Submit Feedback</button>
        </form>
      </section>
    </div>
  </main>
  
  <!-- Fixed Panels for Connectivity -->
  <!-- Bluesky Log Panel (Bottom-Right) -->
  <div id="blueskyLogPanel">
    <header>Bluesky Log Display</header>
    <div class="panel-body">
      <div id="logContainer" class="log-container">
        <p class="text-gray-700">Initializing Bluesky connection...</p>
      </div>
      <div class="mt-2 d-flex justify-content-center">
        <button onclick="connectToBluesky()" class="btn btn-primary mr-1">Reconnect</button>
        <button onclick="clearBlueskyLogs()" class="btn btn-secondary">Clear Logs</button>
      </div>
    </div>
  </div>
  <!-- VR Log Panel (Bottom-Left) -->
  <div id="vrLogPanel">
    <header>VR Log Display</header>
    <div class="panel-body">
      <div id="vrLogContainer" class="log-container">
        <p class="text-gray-700">Initializing VR connection...</p>
      </div>
      <div class="mt-2 d-flex justify-content-center">
        <button onclick="connectToVR()" class="btn btn-primary mr-1">Reconnect</button>
        <button onclick="clearVRLogs()" class="btn btn-secondary">Clear Logs</button>
      </div>
    </div>
  </div>
  
  <!-- Floating Ko‑fi Bubble -->
  <div id="kofiBubble" onclick="window.open('https://ko-fi.com/kevinmarville','_blank')" title="Support my work on Ko‑fi">
    💳
  </div>
  
  <!-- Live Notifications Panel (Upper Center) -->
  <div id="notificationPanel" class="hidden">
    <!-- Notifications will be appended here dynamically -->
  </div>
  
  <!-- Feedback Modal -->
  <div id="feedbackModal" class="modal-feedback">
    <header>Feedback</header>
    <textarea id="modalFeedbackText" placeholder="Share your thoughts..."></textarea>
    <div class="d-flex justify-content-end">
      <button class="btn btn-secondary mr-2" onclick="closeFeedbackModal()">Cancel</button>
      <button class="btn btn-primary" onclick="submitFeedbackModal()">Submit</button>
    </div>
  </div>
  
  <!-- FOOTER -->
  <footer class="bg-dark text-white mt-auto" style="position: relative;">
    <div class="container">
      <aside class="mb-3">
        <h3 class="decorative-title">
          {% if session.get('lang', 'en') == 'fr' %}Suivez-nous &copy;{% else %}Follow Us &copy;{% endif %}
        </h3>
        <div class="social-links">
          <a href="https://kvnbbg.fr" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="fas fa-rss"></i> Blog</a>
          <a href="https://www.instagram.com/techandstream" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="fab fa-instagram"></i> Instagram</a>
          <a href="https://www.threads.net/@techandstream" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="fas fa-comment-dots"></i> Threads</a>
          <a href="https://x.com/techandstream" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="fab fa-twitter"></i> X</a>
          <a href="https://www.youtube.com/techandstream" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="fab fa-youtube"></i> YouTube</a>
          <a href="https://www.facebook.com/kvnbbg" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="fab fa-facebook-f"></i> Facebook</a>
          <!-- Ko‑fi link also included in footer -->
          <a href="https://ko-fi.com/kevinmarville" target="_blank" rel="noopener noreferrer" class="text-white mx-2"><i class="fas fa-coffee"></i> Ko‑fi</a>
        </div>
      </aside>
      <p class="m-0">&copy; 2025 Kevin Marville. All rights reserved.</p>
    </div>
  </footer>
  
  {% block scripts %}{% endblock %}
  
  <!-- Inline Scripts: Extended Functionalities -->
  <script>
    // PARTICLE EFFECT for buttons
    document.querySelectorAll('.particle-effect').forEach(el => {
      el.addEventListener('mouseenter', () => { el.style.boxShadow = "0 0 15px rgba(0, 123, 255, 0.5)"; });
      el.addEventListener('mouseleave', () => { el.style.boxShadow = "none"; });
    });
    console.log("Interactive enhancements active.");
    
    // Toggle Panels for Bluesky & VR connectivity
    document.getElementById('blueskyConnectBtn').addEventListener('click', (e) => {
      e.preventDefault();
      const panel = document.getElementById('blueskyLogPanel');
      panel.style.display = (panel.style.display === 'none' || panel.style.display === '') ? 'block' : 'none';
      console.log("Bluesky Connect toggled.");
    });
    document.getElementById('vrConnectBtn').addEventListener('click', (e) => {
      e.preventDefault();
      const panel = document.getElementById('vrLogPanel');
      panel.style.display = (panel.style.display === 'none' || panel.style.display === '') ? 'block' : 'none';
      console.log("VR Connect toggled.");
    });
    
    // Dark Mode Toggle
    document.getElementById('darkModeToggle').addEventListener('click', (e) => {
      e.preventDefault();
      document.body.classList.toggle('dark-mode');
      if(document.body.classList.contains('dark-mode')){
        document.body.style.background = '#222';
        document.body.style.color = '#ddd';
      } else {
        document.body.style.background = 'var(--background-color)';
        document.body.style.color = 'var(--text-color)';
      }
      console.log("Dark mode toggled.");
    });
    
    // Feedback Modal: Show/Hide
    document.getElementById('feedbackBtn').addEventListener('click', (e) => {
      e.preventDefault();
      document.getElementById('feedbackModal').classList.add('active');
    });
    function closeFeedbackModal(){
      document.getElementById('feedbackModal').classList.remove('active');
    }
    function submitFeedbackModal(){
      const feedback = document.getElementById('modalFeedbackText').value;
      console.log("Feedback submitted:", feedback);
      alert("Thank you for your feedback!");
      document.getElementById('modalFeedbackText').value = "";
      closeFeedbackModal();
    }
    
    // SECURITY: Periodic Check-in (every 30 seconds)
    function securityCheckIn() {
      const now = new Date().toISOString();
      console.log("[SECURITY] Check in at " + now);
      // Append security log to Bluesky and VR log panels (if visible)
      if(document.getElementById('logContainer'))
        document.getElementById('logContainer').innerHTML += `<p class='text-purple-700'>[SECURITY] ${now}</p>`;
      if(document.getElementById('vrLogContainer'))
        document.getElementById('vrLogContainer').innerHTML += `<p class='text-purple-700'>[SECURITY] ${now}</p>`;
    }
    setInterval(securityCheckIn, 30000);
    
    // DISTRIBUTION LOOP: Periodically send logs (every 60 seconds)
    function distributionLoop() {
      const blueskyLogs = document.getElementById('logContainer').innerHTML;
      const vrLogs = document.getElementById('vrLogContainer').innerHTML;
      const payload = { bluesky: blueskyLogs, vr: vrLogs, timestamp: new Date().toISOString() };
      console.log("[DISTRIBUTION] Sending logs...", payload);
      fetch('/distribute-logs', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      }).then(response => {
        if(response.ok) { console.log("[DISTRIBUTION] Logs distributed successfully."); }
        else { console.error("[DISTRIBUTION] Failed with status " + response.status); }
      }).catch(error => { console.error("[DISTRIBUTION] Error: " + error.message); });
    }
    setInterval(distributionLoop, 60000);
    
    // Simulated Bluesky Connection with Handshake Tracking
    async function connectToBluesky() {
      const logContainer = document.getElementById("logContainer");
      logContainer.innerHTML += "<p class='text-blue-700'>[Bluesky HANDSHAKE] Initiating connection...</p>";
      console.log("[Bluesky HANDSHAKE] Initiating connection...");
      try {
        const response = await fetch('https://bsky.social/api/session');
        if (!response.ok) throw new Error(`HTTP status ${response.status}`);
        logContainer.innerHTML += "<p class='text-green-700'>[Bluesky HANDSHAKE] Connection successful!</p>";
        console.log("[Bluesky HANDSHAKE] Connection successful!");
      } catch (error) {
        logContainer.innerHTML += `<p class='text-red-700'>[Bluesky HANDSHAKE] Connection failed: ${error.message}</p>`;
        console.error("[Bluesky HANDSHAKE] Connection failed:", error);
        alternativeBlueskyConnect();
      }
    }
    function alternativeBlueskyConnect() {
      const logContainer = document.getElementById("logContainer");
      logContainer.innerHTML += "<p class='text-orange-700'>[Bluesky HANDSHAKE] Attempting alternative connection...</p>";
      console.log("[Bluesky HANDSHAKE] Attempting alternative connection...");
      setTimeout(() => {
        logContainer.innerHTML += "<p class='text-green-700'>[Bluesky HANDSHAKE] Alternative connection established.</p>";
        console.log("[Bluesky HANDSHAKE] Alternative connection established.");
      }, 2000);
    }
    
    // Simulated VR Connection with Handshake Tracking
    async function connectToVR() {
      const logContainer = document.getElementById("vrLogContainer");
      logContainer.innerHTML += "<p class='text-blue-700'>[VR HANDSHAKE] Initiating VR connection...</p>";
      console.log("[VR HANDSHAKE] Initiating VR connection...");
      try {
        // Replace with your real VR endpoint as needed
        const response = await fetch('https://vr.example.com/api/session');
        if (!response.ok) throw new Error(`HTTP status ${response.status}`);
        logContainer.innerHTML += "<p class='text-green-700'>[VR HANDSHAKE] VR connection successful!</p>";
        console.log("[VR HANDSHAKE] VR connection successful!");
      } catch (error) {
        logContainer.innerHTML += `<p class='text-red-700'>[VR HANDSHAKE] VR connection failed: ${error.message}</p>`;
        console.error("[VR HANDSHAKE] VR connection failed:", error);
        alternativeVRConnect();
      }
    }
    function alternativeVRConnect() {
      const logContainer = document.getElementById("vrLogContainer");
      logContainer.innerHTML += "<p class='text-orange-700'>[VR HANDSHAKE] Attempting alternative VR connection...</p>";
      console.log("[VR HANDSHAKE] Attempting alternative VR connection...");
      setTimeout(() => {
        logContainer.innerHTML += "<p class='text-green-700'>[VR HANDSHAKE] Alternative VR connection established.</p>";
        console.log("[VR HANDSHAKE] Alternative VR connection established.");
      }, 2000);
    }
    
    // Clear Logs Functions
    function clearBlueskyLogs() {
      document.getElementById("logContainer").innerHTML = "<p class='text-gray-700'>Bluesky logs cleared.</p>";
      console.log("Bluesky logs cleared.");
    }
    function clearVRLogs() {
      document.getElementById("vrLogContainer").innerHTML = "<p class='text-gray-700'>VR logs cleared.</p>";
      console.log("VR logs cleared.");
    }
    
    // Live Notifications Simulation
    function showNotification(message) {
      const panel = document.getElementById('notificationPanel');
      panel.classList.remove('hidden');
      const notif = document.createElement('p');
      notif.innerText = message;
      notif.className = "text-green-700";
      panel.appendChild(notif);
      // Auto-hide notification panel after 10 seconds
      setTimeout(() => { panel.classList.add('hidden'); }, 10000);
    }
    // Simulate notifications every 45 seconds
    setInterval(() => {
      const messages = [
        "New update available!",
        "Your simulation data has been calibrated.",
        "A new feature has been added. Check the dashboard!",
        "Don't forget to check our latest blog post.",
        "Live chat session starting soon."
      ];
      const randomMsg = messages[Math.floor(Math.random() * messages.length)];
      showNotification(randomMsg);
    }, 45000);
    
    // Feedback Form Handling (for inline form in the Feedback Section)
    document.getElementById('feedbackForm').addEventListener('submit', function(e){
      e.preventDefault();
      const name = document.getElementById('feedbackName').value;
      const email = document.getElementById('feedbackEmail').value;
      const message = document.getElementById('feedbackMessage').value;
      console.log("Feedback received:", {name, email, message});
      alert("Thank you for your feedback!");
      this.reset();
    });
  </script>
  
  <!-- Three.js Car Simulation Script (unchanged) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // -------------------------------
    // Three.js Car Simulation Setup
    // -------------------------------
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    const canvasContainer = document.getElementById('threejs-canvas-container');
    if (canvasContainer) { canvasContainer.appendChild(renderer.domElement); }
    else { document.body.appendChild(renderer.domElement); }
    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(5, 10, 7.5);
    light.castShadow = true;
    scene.add(light);
    const ambientLight = new THREE.AmbientLight(0x404040);
    scene.add(ambientLight);
    const carGeometry = new THREE.BoxGeometry(2, 0.5, 1);
    const carMaterial = new THREE.MeshPhongMaterial({ color: 0x0077ff, shininess: 100 });
    const car = new THREE.Mesh(carGeometry, carMaterial);
    car.castShadow = true;
    scene.add(car);
    const wheelGeometry = new THREE.CylinderGeometry(0.2, 0.2, 0.1, 32);
    const wheelMaterial = new THREE.MeshPhongMaterial({ color: 0x333333 });
    const wheelPositions = [[-0.9, -0.3, 0.5], [0.9, -0.3, 0.5], [-0.9, -0.3, -0.5], [0.9, -0.3, -0.5]];
    wheelPositions.forEach(pos => {
      const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
      wheel.position.set(...pos);
      wheel.rotation.z = Math.PI/2;
      wheel.castShadow = true;
      scene.add(wheel);
    });
    const groundGeometry = new THREE.PlaneGeometry(50, 50);
    const groundMaterial = new THREE.MeshPhongMaterial({ color: 0x999999 });
    const ground = new THREE.Mesh(groundGeometry, groundMaterial);
    ground.rotation.x = -Math.PI/2;
    ground.position.y = -0.4;
    ground.receiveShadow = true;
    scene.add(ground);
    camera.position.set(0, 2, 6);
    camera.lookAt(0, 0, 0);
    let carSpeed = 0, carRotation = 0;
    const maxSpeed = 0.1, acceleration = 0.002, deceleration = 0.001;
    document.getElementById('left-btn').addEventListener('click', () => { carRotation -= 0.05; });
    document.getElementById('right-btn').addEventListener('click', () => { carRotation += 0.05; });
    document.getElementById('up-btn').addEventListener('click', () => { if(carSpeed < maxSpeed) carSpeed += acceleration; });
    document.getElementById('stop-btn').addEventListener('click', () => { carSpeed = 0; });
    document.addEventListener('mousemove', (event) => {
      const mouseX = (event.clientX / window.innerWidth) * 2 - 1;
      const mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
      car.position.x = THREE.MathUtils.lerp(car.position.x, mouseX * 3, 0.1);
      car.position.y = THREE.MathUtils.lerp(car.position.y, mouseY, 0.1);
    });
    function animate() {
      requestAnimationFrame(animate);
      car.rotation.y = THREE.MathUtils.lerp(car.rotation.y, carRotation, 0.1);
      car.position.z -= carSpeed;
      if(carSpeed > 0) { carSpeed -= deceleration; }
      renderer.render(scene, camera);
    }
    animate();
    window.addEventListener('resize', () => {
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
    });
  </script>
  
  <!-- Version Modal -->
  <aside>
    <div class="modal fade" id="versionModal" tabindex="-1" role="dialog" aria-labelledby="versionModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <section class="modal-header">
            <h5 class="modal-title" id="versionModalLabel">
              {% if session.get('lang', 'en') == 'fr' %}Information de Version{% else %}Version Information{% endif %}
            </h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </section>
          <div class="modal-body">
            <p>
              {% if session.get('lang', 'en') == 'fr' %}
                Version du produit : <strong id="product-version">v1.0.0</strong>
              {% else %}
                Product Version: <strong id="product-version">v1.0.0</strong>
              {% endif %}
            </p>
          </div>
          <section class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">
              {% if session.get('lang', 'en') == 'fr' %}Fermer{% else %}Close{% endif %}
            </button>
          </section>
        </div>
      </div>
    </div>
  </aside>
  
</body>
</html>
